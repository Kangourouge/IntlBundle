{% extends 'EasyAdminBundle:form:bootstrap_3_horizontal_layout.html.twig' %}

{% block translation_widget %}
    {% if form.vars.attr.lang is defined %}
        {%- set type = type|default('text') -%}

        <div class="input-group {% if form.vars.attr.lang != form.vars.attr.default_locale %}hidden{% endif %}">
            {% set attr = attr|merge({"aria-describedby" : form.vars.id ~ "_addon"}) %}
            {{- parent() -}}

            <div class="input-group-addon" id="{{ form.vars.id }}_addon">
                <img src="{{ asset('/bundles/krgintl/images/flags/' ~ form.vars.attr.lang ~ '.svg') }}" width="30">
            </div>
        </div>

    {% else %}
        {{- parent() -}}
    {% endif %}
{%- endblock translation_widget %}

{%- block form_row -%}
    {% if form.vars.label is same as(false) %}
        {{- block('form_widget') -}}
    {% else %}
        {{ parent() }}
    {% endif %}
{%- endblock form_row -%}

{%- block form_start -%}

    {{ parent() }}

    {% if form.vars.locales is defined %}


        <div id="{{ form.vars.id }}_btn_group_locales" style="margin-bottom: 40px">
            <ul class="nav nav-fill nav-tabs">
                <li class="nav-item">
                    <h4 style="padding-right: 20px">{{ 'Language'|trans }}</h4>
                </li>
                {% for locale in form.vars.locales %}
                    <li class="nav-item {% if form.vars.default_locale == locale %} active {% endif %}">
                        <a lang="{{ locale }}" href="#" class="nav-link">
                            <img lang="{{ locale }}" src="{{ asset('/bundles/krgintl/images/flags/' ~ locale ~ '.svg') }}" width="30"/> {{ locale | upper }}
                        </a>
                    </li>
                {% endfor %}
            </ul>
        </div>

        <script type="text/javascript">
            document.addEventListener('DOMContentLoaded', function (event) {
                var form = document.{{ form.vars.name }};
                var defaultLocale = '{{ form.vars.default_locale }}';
                var languages = form.querySelectorAll('#{{ form.vars.id }}_btn_group_locales a[lang]');
                var elements = form.querySelectorAll('input[lang], textarea[lang]');

                function onChange(event) {
                    var currentLocale = event instanceof Event ? event.target.lang : defaultLocale;

                    Array.prototype.forEach.call(elements, function (element) {
                        var div = element.parentNode;
                        div.classList.add("hidden");
                        if (currentLocale === element.lang) {
                            div.classList.remove("hidden");
                        }
                    });

                    Array.prototype.forEach.call(languages, function (anchor) {
                        anchor.parentNode.classList.remove("active");
                        if (currentLocale === anchor.lang) {
                            anchor.parentNode.classList.add("active");
                        }
                    });
                }

                Array.prototype.forEach.call(languages, function (anchor) {
                    anchor.addEventListener('click', onChange, true);
                });

                onChange();
            });
        </script>
    {% endif %}
{% endblock form_start %}
